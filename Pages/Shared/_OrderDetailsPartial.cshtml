@model NLI_POS.Models.ViewModels.OrderSummaryViewModel

<div class="table-responsive">
    <table class="table table-bordered table-hover shadow-sm rounded bg-white">
        <thead class="table-primary text-center">
            <tr>
                <th>Item #</th>
                <th>Category</th>
                <th>Item(s)</th>
                <th>Sub-Item(s)</th>
                <th class="text-end">Price</th>
                <th class="text-end">Qty</th>
                <th class="text-end">Amount</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (Model.ProductItems != null && Model.ProductItems.Any())
            {
                int index = 1;
                foreach (var item in Model.ProductItems)
                {
                    <tr>
                        <td>@(index++)</td>
                        <td>@item.ProductCat</td>
                        <td>@item.ProductName</td>
                        <td>@item.ComboName</td>
                        <td class="text-end">@item.Price.ToString("N2")</td>
                        <td class="text-end">@item.Quantity.ToString("0")</td>
                        <td class="text-end">@item.Amount.ToString("N2")</td>
                        <td></td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="8" class="text-center text-muted">No items found.</td></tr>
            }
        </tbody>
        <tfoot class="table-light fw-bold">
            <tr>
                <td colspan="4" class="text-end">Total:</td>
                <td class="text-end">@Model.ProductItems.Sum(i => i.Price).ToString("N2")</td>
                <td class="text-end">@Model.ProductItems.Sum(i => i.Quantity).ToString("0")</td>
                <td class="text-end">@Model.ProductItems.Sum(i => i.Amount).ToString("N2")</td>
                <td></td>
            </tr>

            @* Payment Summary *@
            @{
                var paidAmount = Model.Order.TotPaidAmount;
                var totalAmount = Model.ProductItems.Sum(i => i.Amount);
                var change = paidAmount - totalAmount;

                var payments = Model.Payments;
                var isCash = payments.All(p => p.PayMethod?.ToLower() == "cash");
            }

            @foreach (var payment in Model.Payments)
            {
                <tr class="table-light">
                    <td colspan="4" class="text-end">Payment Method:</td>
                    <td colspan="2" class="text-end">@payment.PayMethod</td>
                    <td class="text-end">@payment.Amount.ToString("N2")</td>
                    <td class="text-muted small">@(!string.IsNullOrWhiteSpace(payment.ReferenceNo) ? $"Ref#: {payment.ReferenceNo}" : "")</td>
                </tr>
            }

@*             @if (isCash)
            { *@
                <tr class="table-light">
                    <td colspan="6" class="text-end">Change:</td>
                    <td class="text-end">@change.ToString("N2")</td>
                    <td></td>
                </tr>
            @* } *@
        </tfoot>
    </table>
</div>
