@page
@model BackupModel


@{
    ViewData["Title"] = "Manual Database Backup";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-success pt-2">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 > <i class="fas fa-database fa-lg me-2"></i> Database Backup</h5>
                    <i class="fas fa-window-close fa-2xl text-danger" role="button" title="Close" onclick="window.location = '/';"></i>
                </div>
                <div class="card-body">

                    <p class="text-muted">Click the button below to create a manual backup of the database.</p>

                    <form method="post" onsubmit="return confirmBackup();">
                        <button type="submit" class="btn btn-outline-success" ><i class="fa-solid fa-rotate me-2"></i> Backup Now</button>
                    </form>

                    @if (!string.IsNullOrEmpty(TempData["Message"] as string))
                    {
                        <div class="alert alert-info alert-dismissible fade show mt-4" role="alert">
                            <strong>@TempData["Message"]</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

                            @if (!string.IsNullOrEmpty(Model.BackupFilePath))
                            {
                                <div class="mt-2">
                                    <a href="@Url.Content($"~/Backups/{System.IO.Path.GetFileName(Model.BackupFilePath)}")"
                                       class="btn btn-sm btn-outline-primary" download>
                                        <i class="fa-solid fa-download me-2"></i> Download Backup
                                    </a>
                                </div>
                            }
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmBackup() {
            if (confirm("Are you sure you want to start the backup?")) {
                showLoader(); // only show loader after confirmation
                return true;  // allow form to submit
            }
            return false;     // cancel submission
        }

    </script>
}
