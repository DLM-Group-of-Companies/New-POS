@page
@model NLI_POS.Pages.Countries.IndexModel

@{
    ViewData["Title"] = "Countries";
}
<div class="container-fluid bg-white bg-gradient shadow p-2">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0 text-primary">
            <i class="fas fa-globe"></i> @ViewData["Title"]
        </h4>
        <i class="fas fa-window-close fa-2xl text-danger" role="button" title="Close" onclick="window.location = '/';"></i>
    </div>
    <hr />
    @*     <div class="table-scroll-container">   *@
    <table id="countryTable" class="table table-striped table-bordered table-responsive">
        <thead class="table-warning">
            <tr>
                <th>@Html.DisplayNameFor(model => model.Country[0].Code)</th>
                <th>@Html.DisplayNameFor(model => model.Country[0].Name)</th>
                <th>Active</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Country)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.Code)</td>
                    <td>@Html.DisplayFor(modelItem => item.Name)</td>
                    <td>
                        @if (item.IsActive)
                        {
                            <span class="text-success">&#10004;</span>
                        }

                    </td>
                    <td>
                        @* <a asp-page="./Edit" asp-route-id="@item.Id">Edit</a> *@
                        <button class="btn btn-sm btn-success edit-btn" data-id="@item.Id" title="Edit"><i class="far fa-edit"></i></button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
@* </div> *@


<!-- Edit Modal -->
<div class="modal fade" id="editCountryModal" tabindex="-1" aria-labelledby="editCountryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editCountryForm" method="post">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Country</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="Id" id="CountryId" />
                    <div class="mb-3">
                        <label for="CountryCode" class="form-label">Code</label>
                        <input type="text" class="form-control" name="Code" id="CountryCode" readonly />
                    </div>
                    <div class="mb-3">
                        <label for="CountryName" class="form-label">Name</label>
                        <input type="text" class="form-control" name="Name" id="CountryName" readonly />
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="IsActive" id="CountryIsActive" />
                        <label class="form-check-label" for="CountryIsActive">Active</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success"><i class="far fa-save me-2"></i>Save changes</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-caret-square-left me-2"></i>Close</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>

    $(document).ready(function () {
        $('#countryTable').DataTable({
            responsive: true,
            pageLength: 10,
            lengthChange: true,
            pagingType: 'simple_numbers',
        });

        $('.edit-btn').click(function () {
            const id = $(this).data('id');

            // Fetch data via AJAX
            $.get(`/Countries?handler=Get&id=${id}`, function (data) {
                // Fill the modal form
                $('#CountryId').val(data.id);
                $('#CountryCode').val(data.code);
                $('#CountryName').val(data.name);
                $('#CountryIsActive').prop('checked', data.isActive);

                // Show the modal using Bootstrap 5 API
                const modal = new bootstrap.Modal(document.getElementById('editCountryModal'));
                modal.show();
            });
        });

        $('#editCountryForm').submit(function (e) {
            e.preventDefault();
            const formData = $(this).serialize();

            $.post('/Countries/Edit', formData, function () {
                location.reload();
            }).fail(function () {
                alert('Failed to save changes.');
            });
        });
    });
</script>
