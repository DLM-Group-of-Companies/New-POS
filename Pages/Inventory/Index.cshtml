@page
@model NLI_POS.Pages.Inventory.IndexModel

@{
    ViewData["Title"] = "Inventory";
}
<div class="container-fluid bg-white bg-gradient rounded-3 shadow p-2">
    <h3>Inventory</h3>
    <div class="row p-2">
        <div class="form-group col-lg-8">            
            <a class="btn btn-primary" asp-page="Create"><i class="far fa-plus-square"></i> Add New</a>
        </div>
        <div class="form-group col-lg-4">
            <label asp-for="Office" class="control-label"></label>
            <select id="Office" asp-for="Office" class="form-control form-select" asp-items="ViewBag.Office">
                @* <option value="">--Select--</option> *@
            </select>
        </div>
    </div>
    <hr />

    <p class="fw-bold">Main Products</p>

     <table id="mainTable" class="table table-success table-striped">
        <thead>
            <tr>
                <th>Product</th>
                <th class="text-end">Stock</th>

                <th>Actions</th>
            </tr>
        </thead>
    </table>

    <hr/>
    <p class="fw-bold">Marketing Collateral Products</p>


    <table id="collTable" class="table table-info table-striped">
        <thead>
            <tr>
                <th>Product</th>
                <th class="text-end">Stock</th>

                <th>Actions</th>
            </tr>
        </thead>
    </table>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Assign DataTables to variables
            var mainTable = $('#mainTable').DataTable({
                ajax: {
                    url: '@Url.Page("Index", "Main")', // Points to OnGetMain
                    data: function (d) {
                        d.officeId = $('#Office').val(); // Send officeId to server
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'products.productName' },
                    {
                        data: 'stockQty',
                        className: 'text-end',
                        orderable: false, // <--- this disables sorting
                        render: function (data) {
                            return data != null ? data.toLocaleString() : '0';
                        }
                    },
                    {
                        data: 'id',
                        orderable: false, // <--- this disables sorting
                        render: function (data) {
                            return `
                                    <a href="/Orders/Edit?id=${data}">Edit</a> 
                                `;
                        }
                    }
                ],
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });

            var collTable = $('#collTable').DataTable({
                ajax: {
                    url: '@Url.Page("Index", "Collateral")',
                    data: function (d) {
                        d.officeId = $('#Office').val(); // Send officeId to server
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'products.productName' },
                    {
                        data: 'stockQty',
                        className: 'text-end',
                        orderable: false, // <--- this disables sorting
                        render: function (data) {
                            return data != null ? data.toLocaleString() : '0';
                        }
                    },
                    {
                        data: 'id',
                        orderable: false, // <--- this disables sorting
                        render: function (data) {
                            return `
                                    <a href="/Orders/Edit?id=${data}">Edit</a> 
                                `;
                        }
                    }
                ],
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });

            // Reload both tables when office filter changes
            $('#Office').on('change', function () {
                mainTable.ajax.reload();
                collTable.ajax.reload();
            });
        });
    </script>
}